{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-5 mb-4">
            <i class="fas fa-cog me-2"></i> Settings
        </h1>
        <p class="lead">
            Configure your Redmine and Claude API settings.
        </p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card bg-dark">
            <div class="card-header">
                <h5 class="mb-0">Configuration</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('settings') }}" method="post" class="settings-form needs-validation" novalidate>
                    <!-- Redmine Settings -->
                    <div class="mb-4">
                        <h5><i class="fas fa-project-diagram me-2"></i> Redmine Configuration</h5>
                        <hr>
                        
                        <div class="form-group mb-3">
                            <label for="redmine_url" class="form-label">Redmine URL</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-link"></i></span>
                                <input type="url" class="form-control" id="redmine_url" name="redmine_url" 
                                       value="{{ config.redmine_url if config else '' }}"
                                       placeholder="https://redmine.example.com" required>
                            </div>
                            <div class="form-text">The base URL of your Redmine instance</div>
                            <div class="invalid-feedback">Please enter a valid Redmine URL</div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="redmine_api_key" class="form-label">Redmine API Key</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="password" class="form-control api-key-field" id="redmine_api_key" name="redmine_api_key" 
                                       value="{{ config.redmine_api_key if config else '' }}"
                                       placeholder="Your Redmine API key" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="toggleFieldVisibility('redmine_api_key')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                You can find your API key in your Redmine account settings
                            </div>
                            <div class="invalid-feedback">Redmine API key is required</div>
                        </div>
                    </div>
                    
                    <!-- Claude Settings -->
                    <div class="mb-4">
                        <h5><i class="fas fa-robot me-2"></i> Claude Configuration</h5>
                        <hr>
                        
                        <div class="form-group mb-3">
                            <label for="claude_api_key" class="form-label">Claude API Key</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-key"></i></span>
                                <input type="password" class="form-control api-key-field" id="claude_api_key" name="claude_api_key" 
                                       value="{{ config.claude_api_key if config else '' }}"
                                       placeholder="Your Claude API key" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="toggleFieldVisibility('claude_api_key')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                API key from your Anthropic Claude account
                            </div>
                            <div class="invalid-feedback">Claude API key is required</div>
                        </div>
                    </div>
                    
                    <!-- Rate Limiting Settings -->
                    <div class="mb-4">
                        <h5><i class="fas fa-tachometer-alt me-2"></i> Rate Limiting</h5>
                        <hr>
                        
                        <div class="form-group mb-3">
                            <label for="rate_limit_per_minute" class="form-label">API Calls Per Minute</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-stopwatch"></i></span>
                                <input type="number" class="form-control" id="rate_limit_per_minute" name="rate_limit_per_minute" 
                                       value="{{ config.rate_limit_per_minute if config else 60 }}"
                                       min="1" max="1000" required>
                            </div>
                            <div class="form-text">
                                Maximum API calls per minute to prevent rate limiting
                            </div>
                            <div class="invalid-feedback">Please enter a value between 1 and 1000</div>
                        </div>
                    </div>
                    
                    <!-- Credentials File Management -->
                    <div class="mb-4">
                        <h5><i class="fas fa-file-alt me-2"></i> Credentials File</h5>
                        <hr>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="save_to_file" name="save_to_file" value="yes">
                            <label class="form-check-label" for="save_to_file">
                                Save settings to credentials.yaml file
                            </label>
                            <div class="form-text">
                                This will save your settings to a file that can be used to restore configuration.
                                <strong>Note:</strong> The file will contain sensitive API keys.
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" name="action" value="save" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Save Settings
                        </button>
                        <button type="submit" name="action" value="load_from_file" class="btn btn-secondary">
                            <i class="fas fa-sync me-1"></i> Load From File
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Test Connection Card -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-dark">
            <div class="card-header">
                <h5 class="mb-0">Test Connection</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-info" onclick="alert('This functionality is not implemented in this demo')">
                                <i class="fas fa-project-diagram me-1"></i> Test Redmine Connection
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-info" onclick="alert('This functionality is not implemented in this demo')">
                                <i class="fas fa-robot me-1"></i> Test Claude Connection
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

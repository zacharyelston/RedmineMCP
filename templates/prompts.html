{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-5 mb-4">
            <i class="fas fa-file-alt me-2"></i> Prompt Templates
        </h1>
        <p class="lead">
            Manage templates for common LLM prompts.
        </p>
    </div>
</div>

<!-- Template Form -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-dark d-none" id="template-form">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-edit me-2"></i> <span id="form-title">Edit Template</span>
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('prompts') }}" method="post" class="needs-validation" novalidate>
                    <input type="hidden" id="template-id" name="id" value="">
                    
                    <div class="form-group mb-3">
                        <label for="template-name" class="form-label">Template Name</label>
                        <input type="text" class="form-control" id="template-name" name="name" required>
                        <div class="invalid-feedback">Please provide a template name</div>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label for="template-description" class="form-label">Description</label>
                        <textarea class="form-control" id="template-description" name="description" rows="2"></textarea>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label for="template-content" class="form-label">Template Content</label>
                        <textarea class="form-control" id="template-content" name="template" rows="8" required
                                  placeholder="Write your prompt template here. Use {{variables}} for placeholders."></textarea>
                        <div class="form-text">
                            You can use variables like <code>{{project_name}}</code>, <code>{{issue_title}}</code>, etc.
                        </div>
                        <div class="invalid-feedback">Please provide template content</div>
                    </div>
                    
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-secondary me-2" onclick="document.getElementById('template-form').classList.add('d-none')">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Save Template
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Templates List and Create Button -->
<div class="row mb-4">
    <div class="col-12 mb-3">
        <button type="button" class="btn btn-success" onclick="newTemplate()">
            <i class="fas fa-plus me-1"></i> Create New Template
        </button>
    </div>
    
    {% if templates %}
        {% for template in templates %}
        <div class="col-md-6 mb-3" id="template-card-{{ template.id }}">
            <div class="card bg-dark h-100 template-card">
                <div class="card-header">
                    <h5 class="mb-0">{{ template.name }}</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        {{ template.description or 'No description provided' }}
                    </p>
                    <div class="code-block mb-3" style="max-height: 150px; overflow-y: auto;">
                        {{ template.template }}
                    </div>
                    <div class="form-text mb-3">
                        Last updated: <span class="format-date">{{ template.updated_at }}</span>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-sm btn-outline-danger me-2" onclick="deleteTemplate({{ template.id }})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="loadPromptTemplate({{ template.id }})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="col-12">
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i> No templates found. Create your first template using the button above.
        </div>
    </div>
    {% endif %}
</div>

<!-- Example Templates Section -->
<div class="row">
    <div class="col-12">
        <div class="card bg-dark">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb me-2"></i> Example Templates
                </h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="templateExamples">
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#exampleTemplate1">
                                Bug Report Template
                            </button>
                        </h2>
                        <div id="exampleTemplate1" class="accordion-collapse collapse" data-bs-parent="#templateExamples">
                            <div class="accordion-body">
                                <div class="code-block mb-3">
Create a detailed bug report for the following issue:

Problem: {{issue_description}}

Please include:
1. A clear and concise title
2. Steps to reproduce
3. Expected behavior
4. Actual behavior
5. Relevant screenshots or error messages
6. Environment details (browser, OS, etc.)
7. Possible causes or solutions if apparent
                                </div>
                                <button class="btn btn-sm btn-outline-info" onclick="alert('This functionality is not implemented in this demo')">
                                    <i class="fas fa-copy me-1"></i> Copy to New Template
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#exampleTemplate2">
                                Feature Request Template
                            </button>
                        </h2>
                        <div id="exampleTemplate2" class="accordion-collapse collapse" data-bs-parent="#templateExamples">
                            <div class="accordion-body">
                                <div class="code-block mb-3">
Create a comprehensive feature request for the {{project_name}} project:

Feature idea: {{feature_description}}

Please include:
1. A descriptive title for the feature
2. The problem this feature solves
3. A detailed description of the proposed feature
4. Potential user stories or use cases
5. Success criteria for implementing this feature
6. Any potential alternatives or workarounds
7. Additional context or considerations
                                </div>
                                <button class="btn btn-sm btn-outline-info" onclick="alert('This functionality is not implemented in this demo')">
                                    <i class="fas fa-copy me-1"></i> Copy to New Template
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#exampleTemplate3">
                                Issue Analysis Template
                            </button>
                        </h2>
                        <div id="exampleTemplate3" class="accordion-collapse collapse" data-bs-parent="#templateExamples">
                            <div class="accordion-body">
                                <div class="code-block mb-3">
Analyze the following issue and provide your expert insights:

Issue: {{issue_description}}

Please provide:
1. A summary of the key points
2. Identification of root causes
3. Potential impact and severity assessment
4. Recommended priority level
5. Suggested next steps or approaches
6. Estimated complexity (1-5 scale)
7. Related issues or dependencies to consider
                                </div>
                                <button class="btn btn-sm btn-outline-info" onclick="alert('This functionality is not implemented in this demo')">
                                    <i class="fas fa-copy me-1"></i> Copy to New Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Update form title based on whether we're editing or creating
        document.getElementById('template-form').addEventListener('change', function() {
            const idField = document.getElementById('template-id');
            const formTitle = document.getElementById('form-title');
            
            if (idField.value) {
                formTitle.textContent = 'Edit Template';
            } else {
                formTitle.textContent = 'Create New Template';
            }
        });
    });
</script>
{% endblock %}
